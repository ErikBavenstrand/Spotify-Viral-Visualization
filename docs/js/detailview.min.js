/*! viral-50 v0.0.1 | (c) 2020 Erik BÃ¥venstrand | MIT License | https://github.com/ErikBavenstrand/DH2321-Spotify-Project */
const sample=[{language:"Rust",value:78.9,color:"#000000"},{language:"Kotlin",value:75.1,color:"#00a2ee"},{language:"Python",value:68,color:"#fbcb39"},{language:"TypeScript",value:67,color:"#007bc8"},{language:"Go",value:65.6,color:"#65cedb"},{language:"Swift",value:65.1,color:"#ff6e52"},{language:"JavaScript",value:61.9,color:"#f9de3f"},{language:"C#",value:60.4,color:"#5d2f8e"},{language:"F#",value:59.6,color:"#008fc9"},{language:"Clojure",value:59.6,color:"#507dca"}];function donut(){var t,a,e,r=d3.select("body"),n={},l=370,c=370,o=Math.min(l,c)/2,d=d3.scaleOrdinal(["#2ecc71","#3498db","#9b59b6","#8e44ad","#34495e","#e74c3c","#ff6b81","#eccc68","#9c88ff","#25CCF7"]),i=d3.pie().sort(null).value((function(t){return t.value})),s={render:function(){return t?(a.data(i(d3.entries(n))).exit().remove(),a.select("path").transition().duration(200).attrTween("d",(function(t){var a=d3.interpolate(this._current,t);return this._current=a(0),function(t){return e(a(t))}})),a.select("text").attr("transform",(function(t){return"translate("+e.centroid(t)+")"})),t.select("text.text-tooltip").datum(n)):(e=d3.arc().outerRadius(o).innerRadius(o-o/2.5),t=r.append("svg").attr("width",l).attr("height",c).append("g").attr("transform","translate("+l/2+","+c/2+")"),(a=t.selectAll(".arc").data(i(d3.entries(n))).enter().append("g").attr("class","arc")).append("path").each((function(t){this._current=t})).attr("d",e).style("fill",(function(t){return d(t.data.key)})),a.append("text").attr("transform",(function(t){return"translate("+e.centroid(t)+")"})).attr("dy",".35em").style("text-anchor","middle"),a.select("text").text((function(t){return t.data.key})),t.append("text").datum(n).attr("x",0).attr("y",0+o/10).attr("class","text-tooltip").style("text-anchor","middle").attr("font-weight","bold").style("font-size",o/2.5+"px"),a.on("mouseover",(function(a){console.log(a),t.select("text.text-tooltip").attr("fill",(function(){return d(a.data.key)})).text((function(t){return t[a.data.key]}))})),a.on("mouseout",(function(){t.select("text.text-tooltip").text("")}))),s},data:function(t){return arguments.length?(n=t,s):n},$el:function(t){return arguments.length?(r=t,s):r},width:function(t){return arguments.length?(l=t,o=Math.min(l,c)/2,s):l},height:function(t){return arguments.length?(c=t,o=Math.min(l,c)/2,s):c}};return s}window.addEventListener("load",(function(){const t=d3.select("#svg"),a=t.append("g").attr("transform","translate(80, 80)"),e=d3.scaleBand().range([0,850]).domain(sample.map(t=>t.language)).padding(.4),r=d3.scaleLinear().range([300,0]).domain([0,100]);a.append("g").attr("transform","translate(0, 300)").attr("class","xAxisRed").call(d3.axisBottom(e)),a.append("g").attr("class","yAxisRed").call(d3.axisLeft(r)),a.append("g").attr("class","grid").call((()=>d3.axisLeft().scale(r))().tickSize(-850,0,0).tickFormat("")),a.selectAll().data(sample).enter().append("g").append("rect").attr("class","bar").attr("fill","#80cbc4").attr("x",t=>e(t.language)).attr("y",t=>r(t.value)).attr("height",t=>300-r(t.value)).attr("width",e.bandwidth()).on("mouseenter",(function(t){d3.selectAll(".value").attr("opacity",0),d3.select(this).transition().duration(300).attr("opacity",.6).attr("x",t=>e(t.language)-5).attr("width",e.bandwidth()+10);const n=r(t.value);a.append("line").attr("id","limit").attr("x1",0).attr("y1",n).attr("x2",850).attr("y2",n)})).on("mouseleave",(function(){d3.selectAll(".value").attr("opacity",1),d3.select(this).transition().duration(300).attr("opacity",1).attr("x",t=>e(t.language)).attr("width",e.bandwidth()),a.selectAll("#limit").remove(),a.selectAll(".divergence").remove()})),t.append("text").attr("class","label").attr("x",-230).attr("y",80/2.4).attr("transform","rotate(-90)").attr("text-anchor","middle").text("Love meter (%)"),t.append("text").attr("class","label").attr("x",505).attr("y",436).attr("text-anchor","middle").text("Languages"),t.append("text").attr("class","source").attr("x",810).attr("y",436).attr("text-anchor","start")}));var getData=function(){for(var t={},a="",e=0;e<3;e++)t["data-"+(e+1)]=Math.round(100*Math.random()),a+="data-"+(e+1)+" = "+t["data-"+(e+1)]+"<br/>";return d3.select("#data").html(a),t},chart=donut().$el(d3.select("#chart")).data(getData()).render();chart.data(getData()).render(),d3.select("#refresh").on("click",(function(){chart.data(getData()).render()})),d3.select("#detailed").on("click",(function(t){d3.select(".cards").classed("flipped",!1)}));