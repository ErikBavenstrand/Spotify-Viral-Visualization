/*! viral-50 v0.0.1 | (c) 2020 Erik BÃ¥venstrand | MIT License | https://github.com/ErikBavenstrand/DH2321-Spotify-Project */
var attrBarChartColors=["#98abc5","#6b486b","#ff8c00"];function addCountryToDetailView(e){addCountryToWeeklySongs(e),generateAttrBarChart()}function removeCountryFromDetailView(e){removeCountryFromWeeklySongs(e),generateAttrBarChart()}function changeWeekDetailView(){selectedCountries.forEach((function(e){changeWeeklySongsWeek(e)})),generateAttrBarChart()}function addCountryToWeeklySongs(e){var t=d3.select("#weekly-songs-list");t.append("li").attr("id","weekly-songs-"+e).append("div").attr("id","weekly-songs-div-"+e).data([e]).text((function(){return countryCCJSON[e]})).on("click",(function(e){t.selectAll("div").classed("active",!1),d3.select(this).classed("active",!0),d3.selectAll(".weekly-song-list-wrapper").classed("weekly-song-list-wrapper-hidden",!0),d3.select("#weekly-song-tab-"+e).classed("weekly-song-list-wrapper-hidden",!1)})),d3.select("#weekly-songs-list-window").append("div").classed("weekly-song-list-wrapper",!0).classed("weekly-song-list-wrapper-hidden",!0).attr("id","weekly-song-tab-"+e).append("div").classed("weekly-song-list",!0).append("ol").attr("id","weekly-song-list-ul-"+e),1===t.selectAll("li").size()&&(d3.select("#weekly-songs-div-"+e).classed("active",!0),d3.select("#weekly-song-tab-"+e).classed("weekly-song-list-wrapper-hidden",!1)),changeWeeklySongsWeek(e)}function removeCountryFromWeeklySongs(e){var t=d3.select("#weekly-songs-list");d3.select("#weekly-songs-"+e).remove(),d3.select("#weekly-song-tab-"+e).remove(),selectedCountries.length>0&&!t.selectAll("div").classed("active")&&(t.select("div").classed("active",!0),d3.select("#weekly-songs-list-window").select("div").classed("weekly-song-list-wrapper-hidden",!1))}function changeWeeklySongsWeek(e){d3.select("#weekly-song-list-ul-"+e).selectAll("li").remove(),data_songs[dataWeek][e]&&(d3.select("#weekly-song-list-ul-"+e).selectAll("li").data(data_songs[dataWeek][e]).enter().append("li").append("div").classed("song-entry-wrapper",!0).append("div").classed("song-name",!0).text((function(e){return e["Track Name"]})),d3.select("#weekly-song-list-ul-"+e).selectAll(".song-entry-wrapper").data(data_songs[dataWeek][e]).append("div").classed("artist-name",!0).text((function(e){return e.Artist})))}function generateAttrBarChart(){var e=["danceability","energy","speechiness","acousticness","instrumentalness","liveness","valence"],t=e.length,n=selectedCountries.length,a=d3.range(n).map((function(n){return d3.range(t).map((function(t){return data_attrs[dataWeek][selectedCountries[n]][e[t]]}))})),s=20,l=30,r=30,d=40,i=160*t-d-l,c=500-s-r,o=d3.scaleLinear().domain([0,1]).range([c,0]),g=d3.scaleBand().domain(d3.range(t)).range([0,i],.2),u=d3.scaleBand().domain(d3.range(n)).range([0,g.bandwidth()-10]),p=d3.scaleOrdinal().range(attrBarChartColors.slice(0,n));d3.select("#attr-barchart-wrapper").selectAll("svg").remove();var y=d3.select("#attr-barchart-wrapper").append("svg").attr("width",i+d+l).attr("height",c+s+r).append("g").attr("transform","translate("+d+","+s+")");y.append("g").selectAll("g").data(a).enter().append("g").style("fill",(function(e,t){return p(t)})).attr("transform",(function(e,t){return"translate("+u(t)+",0)"})).selectAll("rect").data((function(e){return e})).enter().append("rect").attr("width",u.bandwidth()).attr("height",(function(e){return o(1-e)})).attr("x",(function(e,t){return g(t)})).attr("y",(function(e){return c-o(1-e)})),y.append("g").attr("transform","translate(0,"+c+")").call(d3.axisBottom(g).tickFormat((function(t){return e[t]}))),y.append("g").call(d3.axisLeft(o)),y.selectAll("g.tick").filter((function(t){if(e.indexOf(d3.select(this).text())>-1)return!0})).select("text").classed("attribute-text",!0)}d3.select("#close-detail").on("click",(function(e){var t=selectedCountries.slice(0);t.forEach((function(e){selectedCountries.splice(selectedCountries.indexOf(e),1),d3.select("#country-list-"+e).style("color",null),removeCountryFromWeeklySongs(e),checkToggleListClickability()})),zoomOutCountryHideDetail(t[0])}));