/*! viral-50 v0.0.1 | (c) 2020 Erik BÃ¥venstrand | MIT License | https://github.com/ErikBavenstrand/DH2321-Spotify-Project */
var chart,lineMarker,chartTooltip,prevTooltipX,chartCountryLines=[],indexOfCC={},lineChartColors=["#fff","#00f","#f00"],usedLineChartColors=[];lineChartColors.forEach((function(){usedLineChartColors.push(!1)}));var container=d3.select("#linechart"),margin={top:50,right:90,bottom:40,left:50},totalWidth=+container.style("width").slice(0,-2),innerWidth=totalWidth-margin.left-margin.right,totalHeight=+container.style("height").slice(0,-2),innerHeight=totalHeight-margin.top-margin.bottom,xMax=weeks.length-1,xScale=d3.scaleLinear().domain([0,xMax]).range([0,innerWidth]),yScale=d3.scaleLinear().domain([0,1]).range([innerHeight,0]),lineModel=d3.line().x((function(t){return xScale(t.x)})).y((function(t){return yScale(t.y)})).curve(d3.curveLinear);function addCountryToLineChart(t){var a,e=Object.values(data_attrs),r=[];Object.values(data_attrs).filter((function(t,a){return a<e.length-2})).map((function(a){r.push(a[t][currentAttribute])})),r=r.map((function(t,a){return{x:a,y:t}})),usedLineChartColors.some((function(t,e){return t||(a=e),!t})),usedLineChartColors[a]=!0,chartCountryLines.push({CC:t,data:r,color:a}),reloadLineChart()}function removeCountryFromLineChart(t){chartCountryLines=chartCountryLines.filter((function(a){return a.CC!=t||(usedLineChartColors[a.color]=!1,!1)})),reloadLineChart()}function reloadLineChart(){createLineChart(),chartCountryLines.forEach((function(t){drawLine(t),addDataPointDots(t)})),addGridLines(),updateLineChartWeek()}function createLineChart(){container.selectAll("svg").remove(),(chart=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).append("g").attr("transform","translate("+margin.left+","+margin.top+")")).append("g").attr("class","x axis").attr("transform","translate(0,"+innerHeight+")").call(d3.axisBottom(xScale)),chart.append("g").attr("class","y axis").call(d3.axisLeft(yScale)),lineMarker=chart.append("rect").attr("class","chart-marker").style("position","absolute").style("z-index","19").style("width","2px").style("height",innerHeight),d3.selectAll(".chart-tooltip").remove(),chartTooltip=container.append("div").attr("class","chart-tooltip").style("opacity",0).style("left",margin.left).style("top",totalHeight),prevTooltipX=0;var t=5,a=15,e=0,r=10,n=chart.append("g").attr("transform","translate("+(innerWidth+r)+","+t+")").attr("class","chart-legend");n.append("rect").attr("class","chart-legend-box").attr("width",margin.right-r-a).attr("height",innerHeight-t-e),n.append("circle").attr("class","chart-legend-dot").attr("r",3).attr("cx",10).attr("cy",15),n.append("text").attr("x",17).attr("y",15).attr("dy","0.35em").text("Country")}function drawLine(t){chart.append("path").attr("class","line").classed("line-loaded",!0).attr("stroke",lineChartColors[t.color]).data([t.data]).attr("d",lineModel)}function addGridLines(){d3.selectAll(".y.axis > .tick").each((function(){var t=d3.create("svg:line").attr("class","y-gridline").attr("x1",0).attr("x2",innerWidth);this.append(t.node())}))}function addDataPointDots(t){chart.selectAll(".dot").data(t.data).enter().append("circle").attr("class","chart-dot").attr("opacity","0.5").attr("cx",(function(t){return xScale(t.x)})).attr("cy",(function(t){return yScale(t.y)})).attr("r",3).attr("fill",lineChartColors[t.color])}function updateLineChartWeek(){var t=155-weeks.indexOf(dataWeek),a=xScale(Math.round(t));lineMarker.attr("x",a-.5+"px");var e=Math.round(xScale.invert(a));chart.selectAll(".chart-dot").classed("focus",(function(t){return t.x==e})).classed("nonfocus",(function(t){return t.x!=e})).each((function(t){t.x==e&&updateChartTooltip(t,a)}))}function updateChartTooltip(t,a){var e=Math.round(xScale.invert(a)),r=xScale(e)+margin.left/2,n=margin.top-30,i="X: "+t.x+"<br> Y: "+t.y.toFixed(3);e!=prevTooltipX&&chartTooltip.interrupt(),chartTooltip.transition().duration(200).delay(100).ease(d3.easeCubic).style("opacity",.85).style("left",r+"px").style("top",n+"px"),chartTooltip.html(i),prevTooltipX=e}